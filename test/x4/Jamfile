#==============================================================================
#   Copyright (c) 2001-2013 Joel de Guzman
#   Copyright (c) 2001-2012 Hartmut Kaiser
#   Copyright (c) 2011 Bryce Lelbach
#   Copyright (c) 2025 Nana Sakisaka
#
#   Distributed under the Boost Software License, Version 1.0. (See accompanying
#   file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#==============================================================================

import-search /boost/config/checks ;
import config : requires ;
import modules ;
import feature ;
import testing ;

project spirit-x4
    : requirements
        <include>.
        <c++-template-depth>512
        [ requires
            # Assume all the cxx11 checks succeed if any of cxx14 does.
            #cxx14_binary_literals               # grep -Er "[0-9]+b[0-9]+" *
            #cxx14_constexpr
            cxx14_decltype_auto                 # grep -r "decltype(auto)" *
            #cxx14_digit_separators              # grep -Er "[0-9]+'[0-9]+" *
            cxx14_generic_lambdas               # grep -Er "]\s*\\([^\\)]*auto" *
            #cxx14_hdr_shared_mutex              # grep -r "shared_mutex" *
            #cxx14_initialized_lambda_captures   # grep -Er "\\[[^=\\]]+=" *
            #cxx14_aggregate_nsdmi
            cxx14_return_type_deduction         # grep -Er "auto[^\\(=\\)]+\(" *
            #cxx14_std_exchange                  # grep -r "exchange" *
            cxx14_variable_templates
        ]
    ;

local subproject-name = x4 ;

rule run ( sources + : args * : input-files *
         : requirements * : target-name ? : default-build * )
{
    target-name ?= $(subproject-name)_$(sources[1]:D=:S=) ;
    return [ testing.run $(sources) : $(args) : $(input-files)
           : $(requirements) : $(target-name) : $(default-build) ] ;
}

rule compile ( sources + : requirements * : target-name ? )
{
    target-name ?= $(subproject-name)_$(sources[1]:D=:S=) ;
    return [ testing.compile $(sources)
           : $(requirements) : $(target-name) ] ;
}

rule compile-fail ( sources + : requirements * : target-name ? )
{
    target-name ?= $(subproject-name)_$(sources[1]:D=:S=) ;
    return [ testing.compile-fail $(sources)
           : $(requirements) : $(target-name) ] ;
}

obj catch2 : catch_amalgamated.cpp ;

run parser.cpp catch2 ;
run context.cpp catch2 ;
run attribute.cpp catch2 ;
run x3_rule_problem.cpp catch2 ;

run actions.cpp catch2 ;
run alternative.cpp catch2 ;
run and_predicate.cpp catch2 ;
run attr.cpp catch2 ;
run binary.cpp catch2 ;
run bool.cpp catch2 ;
run char.cpp catch2 ;
run char_class.cpp catch2 ;
run container_support.cpp catch2 ;
run debug.cpp catch2 ;
run difference.cpp catch2 ;
run eoi.cpp catch2 ;
run eol.cpp catch2 ;
run eps.cpp catch2 ;

run expect.cpp catch2 ;

run extract_int.cpp catch2 ;
run int.cpp catch2 ;
run kleene.cpp catch2 ;
run lexeme.cpp catch2 ;
run lit.cpp catch2 ;
run list.cpp catch2 ;
run matches.cpp catch2 ;
run no_case.cpp catch2 ;
run no_skip.cpp catch2 ;
run not_predicate.cpp catch2 ;
run omit.cpp catch2 ;
run optional.cpp catch2 ;
run plus.cpp catch2 ;
run with.cpp catch2 ;
run as.cpp catch2 ;

run raw.cpp catch2 ;
run real1.cpp catch2 ;
run real2.cpp catch2 ;
run real3.cpp catch2 ;
run rule1.cpp catch2 ;
run rule2.cpp catch2 ;
run rule3.cpp catch2 ;
run rule4.cpp catch2 ;
run sequence.cpp catch2 ;
run skip.cpp catch2 ;
run symbols1.cpp catch2 ;
run symbols2.cpp catch2 ;
run symbols3.cpp catch2 ;
run tst.cpp catch2 ;

run uint.cpp catch2 ;
run uint_radix.cpp catch2 ;

run confix.cpp catch2 ;
run repeat.cpp catch2 ;
run seek.cpp catch2 ;

run unused.cpp catch2 ;
run attribute_type_check.cpp catch2 ;
run error_handler.cpp catch2 ;
run iterator_check.cpp catch2 ;

run to_utf8.cpp catch2 ;

obj rule_separate_tu_grammar : rule_separate_tu_grammar.cpp ;
run rule_separate_tu.cpp rule_separate_tu_grammar catch2 ;

obj grammar_linker : grammar.cpp ;
run grammar_linker.cpp grammar_linker catch2 ;
